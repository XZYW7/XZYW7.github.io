<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <title>
    
    XZYW7&#39;s Blog
  </title>
  <!-- Icon -->
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-TA/Maya/cmds（四）" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    

    
    <div class="article-meta">
      <a href="/2025/09/10/TA/Maya/cmds%EF%BC%88%E5%9B%9B%EF%BC%89/" class="article-date">
  <time datetime="2025-09-10T13:18:14.017Z" itemprop="datePublished">2025-09-10</time>
</a>
      
    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
        <h2 id="【Maya】Python-For-Maya（Cmds）（四）Controller-Library-LightManager"><a href="#【Maya】Python-For-Maya（Cmds）（四）Controller-Library-LightManager" class="headerlink" title="【Maya】Python For Maya（Cmds）（四）Controller Library &amp; LightManager"></a>【Maya】Python For Maya（Cmds）（四）Controller Library &amp; LightManager</h2><h2 id="Controller-Library"><a href="#Controller-Library" class="headerlink" title="Controller Library"></a>Controller Library</h2><h3 id="Qt-Environment"><a href="#Qt-Environment" class="headerlink" title="Qt Environment"></a>Qt Environment</h3><p>使用QT创建controller lib</p>
<p>和Maya cmdsUi相比，更推荐使用qt</p>
<p>CMDS是为MEL设计的，UI函数只有qt的一小部分</p>
<p>直接(mayapy -m )pip install Qt.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Qt</span><br><span class="line">win = Qt.QtWidgets.QDialog()</span><br><span class="line">win.show()</span><br></pre></td></tr></table></figure>

<p>在maya上这样就直接运行了</p>
<p>但是在正常的python上，根据文档要这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Qt <span class="keyword">import</span> QtWidgets</span><br><span class="line"></span><br><span class="line">app = QtWidgets.QApplication(sys.argv)</span><br><span class="line">button = QtWidgets.QPushButton(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">button.show()</span><br><span class="line">app.exec_()</span><br></pre></td></tr></table></figure>

<p>好像是现代maya版本就是Qt管理窗口，所以已经有QtApp了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Qt <span class="keyword">import</span> QtWidgets,QtCore,QtGui</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets,QtCore,QtGui</span><br><span class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtWidgets,QtCore,QtGui</span><br></pre></td></tr></table></figure>

<p>甚至我只mayapy安装了Qt.py，这三个命令都能用了</p>
<h3 id="Controller-Library-1"><a href="#Controller-Library-1" class="headerlink" title="Controller Library"></a>Controller Library</h3><p>controllerLibrary.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> maya <span class="keyword">import</span> cmds</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">USERAPPDIR = cmds.internalVar(userAppDir = <span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(USERAPPDIR)</span><br><span class="line">DIRECTORY = os.path.join(USERAPPDIR,<span class="string">&#x27;controllerLibrary&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createDirectory</span>(<span class="params">directory = DIRECTORY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Creates the given directory</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        directory(str):The directory to create</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        os.mkdir(directory)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ControllerLibrary</span>(<span class="title class_ inherited__">dict</span>):<span class="comment"># stm继承了个字典……</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, name, directory = DIRECTORY,screenshot = <span class="literal">True</span>, **info</span>):</span><br><span class="line">        createDirectory(directory)<span class="comment"># 不存在路径则创建文件夹路径</span></span><br><span class="line"></span><br><span class="line">        path = os.path.join(directory,<span class="string">&quot;&#123;&#125;.ma&quot;</span>.<span class="built_in">format</span>(name))</span><br><span class="line">        infoFile = os.path.join(directory,<span class="string">&#x27;&#123;&#125;.json&#x27;</span>.<span class="built_in">format</span>(name))<span class="comment"># 保存数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ========保存文件========</span></span><br><span class="line">        cmds.file(rename = path)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> cmds.ls(selection = <span class="literal">True</span>):<span class="comment"># 有选择则只保存选择</span></span><br><span class="line">            cmds.file(force = <span class="literal">True</span>, <span class="built_in">type</span> = <span class="string">&#x27;mayaAscii&#x27;</span>, exportSelected = <span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:<span class="comment"># 无选择则全部保存</span></span><br><span class="line">            cmds.file(save = <span class="literal">True</span>, <span class="built_in">type</span> = <span class="string">&#x27;mayaAscii&#x27;</span>, force = <span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ========保存屏幕快照========</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> screenshot:</span><br><span class="line">            info[<span class="string">&#x27;screenshot&#x27;</span>] = <span class="variable language_">self</span>.saveScreenShot(name,directory = directory)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ========输出json========</span></span><br><span class="line">        info[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">        info[<span class="string">&#x27;path&#x27;</span>] = path</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(infoFile, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(info, f, indent = <span class="number">4</span>)<span class="comment"># 把输入的info储存为json</span></span><br><span class="line">        <span class="variable language_">self</span>[name] = info</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">self, directory = DIRECTORY</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.clear()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1&#x27;</span>,directory)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        files = os.listdir(directory)<span class="comment"># 当前路径下所有文件</span></span><br><span class="line">        mayaFiles = [f <span class="keyword">for</span> f <span class="keyword">in</span> files <span class="keyword">if</span> f.endswith(<span class="string">&#x27;.ma&#x27;</span>)]</span><br><span class="line">        <span class="built_in">print</span>(files)</span><br><span class="line">        <span class="keyword">for</span> ma <span class="keyword">in</span> mayaFiles:</span><br><span class="line">            name,ext = os.path.splitext(ma)<span class="comment"># 分离文件名和扩展名</span></span><br><span class="line">            path = os.path.join(directory,ma)</span><br><span class="line">            </span><br><span class="line">            infoFile = <span class="string">&#x27;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">            <span class="keyword">if</span> infoFile <span class="keyword">in</span> files:</span><br><span class="line">                infoFile = os.path.join(directory, infoFile)</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(infoFile, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    info = json.load(f)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;No info file found&#x27;</span>)</span><br><span class="line">                info = &#123;&#125;</span><br><span class="line">                </span><br><span class="line">            screenshot = <span class="string">&#x27;&#123;&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">            <span class="keyword">if</span> screenshot <span class="keyword">in</span> files:</span><br><span class="line">                info[<span class="string">&#x27;screenshot&#x27;</span>] = os.path.join(directory,name)</span><br><span class="line">            info[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">            info[<span class="string">&#x27;path&#x27;</span>] = path</span><br><span class="line">            <span class="variable language_">self</span>[name] = info</span><br><span class="line">        pprint.pprint(<span class="variable language_">self</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self, name</span>):</span><br><span class="line">        path = <span class="variable language_">self</span>[name][<span class="string">&#x27;path&#x27;</span>]</span><br><span class="line">        cmds.file(path, i = <span class="literal">True</span>, usingNamespace = <span class="literal">False</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">saveScreenShot</span>(<span class="params">self, name, directory = DIRECTORY</span>):</span><br><span class="line">        path = os.path.join(directory, <span class="string">&#x27;&#123;&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(name))</span><br><span class="line">        cmds.viewFit()</span><br><span class="line">        cmds.setAttr(<span class="string">&#x27;defaultRenderGlobals.imageFormat&#x27;</span>, <span class="number">8</span>)<span class="comment"># jpeg</span></span><br><span class="line">        <span class="comment">#cmds.setAttr(&quot;defaultArnoldDriver.aiTranslator&quot;,&#x27;png&#x27;,type = &quot;string&quot;) 阿诺德渲染器</span></span><br><span class="line">        </span><br><span class="line">        cmds.playblast(completeFilename = path, forceOverwrite = <span class="literal">True</span>, <span class="built_in">format</span> = <span class="string">&#x27;image&#x27;</span>, width = <span class="number">200</span>, height = <span class="number">200</span>, showOrnaments = <span class="literal">False</span>, startTime = <span class="number">1</span>, endTime = <span class="number">1</span>, viewer = <span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> path</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/tian0000hai/article/details/116952413%E9%98%BF%E8%AF%BA%E5%BE%B7%E6%B8%B2%E6%9F%93%E5%99%A8%E7%9A%84%E6%B8%B2%E6%9F%93%E8%BE%93%E5%87%BA%E8%AE%BE%E7%BD%AE">https://blog.csdn.net/tian0000hai/article/details/116952413阿诺德渲染器的渲染输出设置</a></p>
<p>libraryUI.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> maya <span class="keyword">import</span> cmds</span><br><span class="line"><span class="keyword">from</span> PySide2 <span class="keyword">import</span> QtWidgets, QtCore, QtGui</span><br><span class="line"><span class="keyword">import</span> conLibrary.controllerLibrary <span class="keyword">as</span> controllerLibrary</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">importlib.reload(controllerLibrary)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ControllerLibraryUI</span>(QtWidgets.QDialog):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The ControllerLibraryUI is a dialog that lets us save and import controllers</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#super(ControllerLibraryUI, self).__init__()</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment">#super是一个，用于调用父类方法，用于多继承，而这里是为了不用考虑继承的父类是什么</span></span><br><span class="line">        <span class="comment">#QtWidgets.QDialog.__init__(self)因为是单继承，和这个相等</span></span><br><span class="line">        <span class="variable language_">self</span>.setWindowTitle(<span class="string">&#x27;Controller LibraryUI&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.library = controllerLibrary.ControllerLibrary()</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.buildUI()</span><br><span class="line">        <span class="variable language_">self</span>.populate()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buildUI</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        This method builds out the UI</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;bulding UI&#x27;</span>)</span><br><span class="line">        <span class="comment"># 整体行分布</span></span><br><span class="line">        layout = QtWidgets.QVBoxLayout(<span class="variable language_">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 行分布中的一行，提供纵向分布，编辑栏view</span></span><br><span class="line">        saveWidget = QtWidgets.QWidget()</span><br><span class="line">        saveLayout = QtWidgets.QHBoxLayout(saveWidget)</span><br><span class="line">        layout.addWidget(saveWidget)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 行内组件</span></span><br><span class="line">        <span class="variable language_">self</span>.saveNameField = QtWidgets.QLineEdit()</span><br><span class="line">        saveLayout.addWidget(<span class="variable language_">self</span>.saveNameField)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 行内组件</span></span><br><span class="line">        saveBtn = QtWidgets.QPushButton(<span class="string">&#x27;Save&#x27;</span>)</span><br><span class="line">        saveBtn.clicked.connect(<span class="variable language_">self</span>.save)</span><br><span class="line">        saveLayout.addWidget(saveBtn)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 新的一行，缩略图view</span></span><br><span class="line">        size = <span class="number">64</span></span><br><span class="line">        buffer = <span class="number">12</span></span><br><span class="line">        <span class="comment"># create a grid list Widget to display our controller thumbnails</span></span><br><span class="line">        <span class="variable language_">self</span>.listWidget = QtWidgets.QListWidget()</span><br><span class="line">        <span class="variable language_">self</span>.listWidget.setViewMode(QtWidgets.QListWidget.IconMode)</span><br><span class="line">        <span class="variable language_">self</span>.listWidget.setIconSize(QtCore.QSize(size,size))</span><br><span class="line">        <span class="variable language_">self</span>.listWidget.setResizeMode(QtWidgets.QListWidget.Adjust)</span><br><span class="line">        <span class="variable language_">self</span>.listWidget.setGridSize(QtCore.QSize(size+buffer,size+buffer))</span><br><span class="line">        layout.addWidget(<span class="variable language_">self</span>.listWidget)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 新的一行button view</span></span><br><span class="line">        btnWidget = QtWidgets.QWidget()</span><br><span class="line">        btnLayout = QtWidgets.QHBoxLayout(btnWidget)</span><br><span class="line">        layout.addWidget(btnWidget)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># button view组件</span></span><br><span class="line">        importBtn = QtWidgets.QPushButton(<span class="string">&#x27;Import&#x27;</span>)</span><br><span class="line">        importBtn.clicked.connect(<span class="variable language_">self</span>.load)</span><br><span class="line">        btnLayout.addWidget(importBtn)</span><br><span class="line">        </span><br><span class="line">        refreshBtn = QtWidgets.QPushButton(<span class="string">&#x27;Refresh&#x27;</span>)</span><br><span class="line">        refreshBtn.clicked.connect(<span class="variable language_">self</span>.populate)<span class="comment">#注意只提供方法名，没有括号，括号代表调用</span></span><br><span class="line">        btnLayout.addWidget(refreshBtn)</span><br><span class="line">        </span><br><span class="line">        closeBtn = QtWidgets.QPushButton(<span class="string">&#x27;Close&#x27;</span>)</span><br><span class="line">        closeBtn.clicked.connect(<span class="variable language_">self</span>.close)<span class="comment"># self.close继承于QDialog</span></span><br><span class="line">        btnLayout.addWidget(closeBtn)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">populate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;This clears the listWidget and then repopulates it with the content of our library&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.listWidget.clear()</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;populating&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.library.find()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> name, info <span class="keyword">in</span> <span class="variable language_">self</span>.library.items():</span><br><span class="line">            item = QtWidgets.QListWidgetItem(name)</span><br><span class="line">            <span class="variable language_">self</span>.listWidget.addItem(item)</span><br><span class="line">            </span><br><span class="line">            screenshot = info.get(<span class="string">&#x27;screenshot&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> screenshot:</span><br><span class="line">                icon = QtGui.QIcon(screenshot)</span><br><span class="line">                item.setIcon(icon)</span><br><span class="line">                </span><br><span class="line">            item.setToolTip(pprint.pformat(info))</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;This loads the currently selected controller&quot;&quot;&quot;</span></span><br><span class="line">        currentItem = <span class="variable language_">self</span>.listWidget.currentItem()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> currentItem:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        name = currentItem.text()</span><br><span class="line">        <span class="variable language_">self</span>.library.load(name)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;This saves the controller with the given file name&quot;&quot;&quot;</span></span><br><span class="line">        name = <span class="variable language_">self</span>.saveNameField.text()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name.strip():</span><br><span class="line">            cmds.warning(<span class="string">&quot;You must give a name!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="variable language_">self</span>.library.save(name)</span><br><span class="line">        <span class="variable language_">self</span>.populate()</span><br><span class="line">        <span class="variable language_">self</span>.saveNameField.setText(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showUI</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This shows and returns a handle to the UI</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Qdialog</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ui = ControllerLibraryUI()</span><br><span class="line">    ui.show()</span><br><span class="line">    <span class="keyword">return</span> ui</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Light-Manager"><a href="#Light-Manager" class="headerlink" title="Light Manager"></a>Light Manager</h2><p>创建一个场景的灯光管理窗口，并且可以和maya的窗口融合</p>
<h3 id="PyMel"><a href="#PyMel" class="headerlink" title="PyMel"></a>PyMel</h3><p>pymel包含了cmds、openmaya</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymel.core <span class="keyword">as</span> pm</span><br><span class="line">cube = pm.polyCube()</span><br><span class="line"><span class="built_in">print</span>(cube)</span><br><span class="line"><span class="comment">#[nt.Transform(&#x27;pCube1&#x27;), nt.PolyCube(&#x27;polyCube1&#x27;)]</span></span><br></pre></td></tr></table></figure>

<p>哥们试了半天，maya2023只有pymel&#x3D;&#x3D;1.3.0a1能用</p>
<p>可以看到pyme创建的polyCube是和openmaya一样附带Node的，并且有一个nt来封装</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cmds.rename(cube[0],&#x27;newName&#x27;)</span></span><br><span class="line">cube[<span class="number">0</span>].rename(<span class="string">&#x27;Foo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../../../../../%25E5%25AD%25A6%25E4%25B9%25A0/%25E6%25B5%2599%25E5%25A4%25A7/Python%2520in%2520Maya/note/Class5/image-20220703154445036.png" alt="image-20220703154445036"></p>
<p>pymel返回的对象不像cmds里面直接是string，是有一个nt对象封装（&#x3D;&#x3D;PyNode class&#x3D;&#x3D;）的，因此使用rename方法也需要调用这个nt对象内部的方法</p>
<p>这就和OpenMaya是差不多的</p>
<ul>
<li>mayatool使用cmd是很常见的</li>
<li>pymel一些情况会很慢，因为它封装了Node对象，不想cmd使用string</li>
<li>pymel也不被Audodesk直接支持，官方文档里也写了这一点</li>
</ul>
<h3 id="UI-and-Partial-funcitons"><a href="#UI-and-Partial-funcitons" class="headerlink" title="UI and Partial funcitons"></a>UI and Partial funcitons</h3><p>lightingManager.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Qt <span class="keyword">import</span> QtWidgets,QtCore,QtGui</span><br><span class="line"><span class="keyword">import</span> pymel.core <span class="keyword">as</span> pm</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">import</span> Qt</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> maya <span class="keyword">import</span> OpenMayaUI <span class="keyword">as</span> omui</span><br><span class="line"></span><br><span class="line">logging.basicConfig()</span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;LightingManager&#x27;</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> Qt.__binding__ == <span class="string">&#x27;PySide&#x27;</span>:</span><br><span class="line">    logger.debug(<span class="string">&#x27;Using Pyside with shiboken&#x27;</span>)</span><br><span class="line">    <span class="keyword">from</span> shiboken <span class="keyword">import</span> warpInstance</span><br><span class="line">    <span class="keyword">from</span> Qt.QtCore <span class="keyword">import</span> Signal</span><br><span class="line"><span class="keyword">elif</span> Qt.__binding__.startswith(<span class="string">&#x27;PyQt&#x27;</span>):</span><br><span class="line">    logger.debug(<span class="string">&#x27;Using PyQt with sip&#x27;</span>)</span><br><span class="line">    <span class="keyword">from</span> sip <span class="keyword">import</span> warpInstance <span class="keyword">as</span> warpInstance</span><br><span class="line">    <span class="keyword">from</span> Qt.QtCore <span class="keyword">import</span> pyqtSignal <span class="keyword">as</span> Signal</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    logger.debug(<span class="string">&#x27;Using PySide2 with shiboken&#x27;</span>)</span><br><span class="line">    <span class="keyword">import</span> shiboken2</span><br><span class="line">    <span class="keyword">from</span> Qt.QtCore <span class="keyword">import</span> Signal</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getMayaMainWindow</span>():</span><br><span class="line">    win = omui.MQtUtil_mainWindow()</span><br><span class="line">    ptr = shiboken2.wrapInstance(<span class="built_in">int</span>(win),QtWidgets.QMainWindow)<span class="comment"># long是python2</span></span><br><span class="line">    <span class="comment"># 并且 shiboken2有改动，不能直接import warpInstance</span></span><br><span class="line">    <span class="keyword">return</span> ptr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getDock</span>(<span class="params">name = <span class="string">&#x27;LightingManagerDock&#x27;</span></span>):</span><br><span class="line">    deleteDock(name)</span><br><span class="line">    ctrl = pm.workspaceControl(name, dockToMainWindow = (<span class="string">&#x27;right&#x27;</span>,<span class="number">1</span>), label = <span class="string">&quot;LightingManager&quot;</span>)</span><br><span class="line">    qtCtrl = omui.MQtUtil_findControl(ctrl)</span><br><span class="line">    ptr = shiboken2.wrapInstance(<span class="built_in">int</span>(qtCtrl),QtWidgets.QWidget)</span><br><span class="line">    <span class="keyword">return</span> ptr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deleteDock</span>(<span class="params">name = <span class="string">&#x27;LightingManagerDock&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> pm.workspaceControl(name, query = <span class="literal">True</span>, exists = <span class="literal">True</span>):</span><br><span class="line">        pm.deleteUI(name)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightManager</span>(QtWidgets.QWidget):<span class="comment"># QtWidgets.QDialog</span></span><br><span class="line">    </span><br><span class="line">    lightTypes = &#123;</span><br><span class="line">        <span class="string">&quot;Point Light&quot;</span>: pm.pointLight,</span><br><span class="line">        <span class="string">&quot;Spot Light&quot;</span>: pm.spotLight,</span><br><span class="line">        <span class="string">&quot;Directional Light&quot;</span>: pm.directionalLight,</span><br><span class="line">        <span class="string">&quot;Area Light&quot;</span>: partial(pm.shadingNode, <span class="string">&#x27;areaLight&#x27;</span>, asLight = <span class="literal">True</span>),</span><br><span class="line">        <span class="string">&quot;Volume Light&quot;</span>: partial(pm.shadingNode, <span class="string">&#x27;volumeLight&#x27;</span>, asLight = <span class="literal">True</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dock = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="comment"># </span></span><br><span class="line">        <span class="keyword">if</span> dock:</span><br><span class="line">            parent = getDock()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            deleteDock()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                pm.deleteUI(<span class="string">&#x27;LightingManager&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                logger.debug(<span class="string">&quot;No previous LightManagerUI exists&quot;</span>)</span><br><span class="line">                </span><br><span class="line">            <span class="comment">#parent = getMayaMainWindow()</span></span><br><span class="line">            parent = QtWidgets.QDialog(parent = getMayaMainWindow())</span><br><span class="line">            </span><br><span class="line">            parent.setObjectName(<span class="string">&#x27;lightingManager&#x27;</span>)</span><br><span class="line">            parent.setWindowTitle(<span class="string">&#x27;Lighting Manager&#x27;</span>)</span><br><span class="line">            layout = QtWidgets.QVBoxLayout(parent)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">super</span>().__init__(parent = parent)<span class="comment"># 把这个窗口的父节点设为maya窗口</span></span><br><span class="line">        <span class="comment">#self.setWindowTitle(&#x27;Lighting Manager&#x27;)</span></span><br><span class="line">        <span class="variable language_">self</span>.buildUI()</span><br><span class="line">        <span class="variable language_">self</span>.populate()</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.parent().layout().addWidget(<span class="variable language_">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> dock:</span><br><span class="line">            parent.show()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">populate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="variable language_">self</span>.scrollLayout.count():</span><br><span class="line">            widget = <span class="variable language_">self</span>.scrollLayout.takeAt(<span class="number">0</span>).widget()</span><br><span class="line">            <span class="keyword">if</span> widget:</span><br><span class="line">                widget.setVisible(<span class="literal">False</span>)</span><br><span class="line">                widget.deleteLater()</span><br><span class="line">        <span class="keyword">for</span> light <span class="keyword">in</span> pm.ls(<span class="built_in">type</span>=[<span class="string">&#x27;areaLight&#x27;</span>,<span class="string">&#x27;spotLight&#x27;</span>,<span class="string">&#x27;pointLight&#x27;</span>,<span class="string">&#x27;directionalLight&#x27;</span>,<span class="string">&#x27;volumeLight&#x27;</span>]):</span><br><span class="line">            <span class="variable language_">self</span>.addLight(light)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buildUI</span>(<span class="params">self</span>):</span><br><span class="line">        layout = QtWidgets.QGridLayout(<span class="variable language_">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.lightTypeCB = QtWidgets.QComboBox()<span class="comment"># 下拉菜单</span></span><br><span class="line">        <span class="keyword">for</span> lightType <span class="keyword">in</span> <span class="built_in">sorted</span>(<span class="variable language_">self</span>.lightTypes):</span><br><span class="line">            <span class="variable language_">self</span>.lightTypeCB.addItem(lightType)</span><br><span class="line">        layout.addWidget(<span class="variable language_">self</span>.lightTypeCB, <span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        createBtn = QtWidgets.QPushButton(<span class="string">&#x27;Create&#x27;</span>)</span><br><span class="line">        createBtn.clicked.connect(<span class="variable language_">self</span>.createLight)</span><br><span class="line">        layout.addWidget(createBtn, <span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        scrollWidget = QtWidgets.QWidget()</span><br><span class="line">        scrollWidget.setSizePolicy(QtWidgets.QSizePolicy.Maximum,QtWidgets.QSizePolicy.Maximum)</span><br><span class="line">        <span class="variable language_">self</span>.scrollLayout = QtWidgets.QVBoxLayout(scrollWidget)</span><br><span class="line">        </span><br><span class="line">        scrollArea = QtWidgets.QScrollArea()</span><br><span class="line">        scrollArea.setWidgetResizable(<span class="literal">True</span>)</span><br><span class="line">        scrollArea.setWidget(scrollWidget)</span><br><span class="line">        layout.addWidget(scrollArea,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>)<span class="comment"># 位于layout第二行第一列，占据1行2列</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        refreshBtn = QtWidgets.QPushButton(<span class="string">&#x27;Refresh&#x27;</span>)</span><br><span class="line">        refreshBtn.clicked.connect(<span class="variable language_">self</span>.populate)</span><br><span class="line">        layout.addWidget(refreshBtn, <span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">createLight</span>(<span class="params">self</span>):</span><br><span class="line">        lightType = <span class="variable language_">self</span>.lightTypeCB.currentText()</span><br><span class="line">        func = <span class="variable language_">self</span>.lightTypes[lightType]</span><br><span class="line">        </span><br><span class="line">        light = func()</span><br><span class="line">        <span class="variable language_">self</span>.addLight(light)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addLight</span>(<span class="params">self, light</span>):</span><br><span class="line">        widget = LightWidget(light)</span><br><span class="line">        <span class="variable language_">self</span>.scrollLayout.addWidget(widget)</span><br><span class="line">        widget.onSolo.connect(<span class="variable language_">self</span>.onSolo)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">onSolo</span>(<span class="params">self, value</span>):</span><br><span class="line">        lightWidgets = <span class="variable language_">self</span>.findChildren(LightWidget)</span><br><span class="line">        <span class="keyword">for</span> widget <span class="keyword">in</span> lightWidgets:</span><br><span class="line">            <span class="keyword">if</span> widget != <span class="variable language_">self</span>.sender():</span><br><span class="line">                widget.disableLight(value)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightWidget</span>(QtWidgets.QWidget):</span><br><span class="line">    </span><br><span class="line">    onSolo = Signal(<span class="built_in">bool</span>)<span class="comment">#QtCore.pyqtSignal 使用pyqt；QtCore.Singal使用pyside2</span></span><br><span class="line">    <span class="comment"># 在我们后面的定义中，对不同版本的Qt进行了判断，可以统一使用</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, light</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(light, <span class="built_in">str</span>):</span><br><span class="line">            light = pm.PyNode(light)</span><br><span class="line">        <span class="variable language_">self</span>.light = light</span><br><span class="line">        <span class="variable language_">self</span>.buildUI()</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buildUI</span>(<span class="params">self</span>):</span><br><span class="line">        layout = QtWidgets.QGridLayout(<span class="variable language_">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 可见性选择框</span></span><br><span class="line">        <span class="variable language_">self</span>.name = QtWidgets.QCheckBox(<span class="built_in">str</span>(<span class="variable language_">self</span>.light.getTransform()))</span><br><span class="line">        <span class="variable language_">self</span>.name.setChecked(<span class="variable language_">self</span>.light.visibility.get())</span><br><span class="line">        <span class="variable language_">self</span>.name.toggled.connect(<span class="keyword">lambda</span> val: <span class="variable language_">self</span>.light.getTransform().visibility.<span class="built_in">set</span>(val))</span><br><span class="line">        <span class="comment">#def setLightVisibility(val):</span></span><br><span class="line">        <span class="comment">#    self.light.visibility.set(val)</span></span><br><span class="line">        <span class="comment"># self.light 只表示shapeNode,因此需要在transofrm上设置可见项</span></span><br><span class="line">        layout.addWidget(<span class="variable language_">self</span>.name, <span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Solo按钮</span></span><br><span class="line">        soloBtn = QtWidgets.QPushButton(<span class="string">&#x27;Solo&#x27;</span>)</span><br><span class="line">        soloBtn.setCheckable(<span class="literal">True</span>)</span><br><span class="line">        soloBtn.toggled.connect(<span class="keyword">lambda</span> val: <span class="variable language_">self</span>.onSolo.emit(val))</span><br><span class="line">        </span><br><span class="line">        layout.addWidget(soloBtn, <span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># 删除按钮</span></span><br><span class="line">        deleteBtn = QtWidgets.QPushButton(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">        deleteBtn.clicked.connect(<span class="variable language_">self</span>.deleteLight)</span><br><span class="line">        deleteBtn.setMaximumWidth(<span class="number">10</span>)</span><br><span class="line">        layout.addWidget(deleteBtn,<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#灯光强度</span></span><br><span class="line">        intensity = QtWidgets.QSlider(QtCore.Qt.Horizontal)</span><br><span class="line">        intensity.setMinimum(<span class="number">1</span>)</span><br><span class="line">        intensity.setMaximum(<span class="number">1000</span>)</span><br><span class="line">        intensity.setValue(<span class="variable language_">self</span>.light.intensity.get())</span><br><span class="line">        intensity.valueChanged.connect(<span class="keyword">lambda</span> val:<span class="variable language_">self</span>.light.intensity.<span class="built_in">set</span>(val))</span><br><span class="line">        layout.addWidget(intensity, <span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="variable language_">self</span>.colorBtn = QtWidgets.QPushButton()</span><br><span class="line">        <span class="variable language_">self</span>.colorBtn.setMaximumWidth(<span class="number">20</span>)</span><br><span class="line">        <span class="variable language_">self</span>.colorBtn.setMaximumHeight(<span class="number">20</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setButtonColor()</span><br><span class="line">        <span class="variable language_">self</span>.colorBtn.clicked.connect(<span class="variable language_">self</span>.setColor)</span><br><span class="line">        layout.addWidget(<span class="variable language_">self</span>.colorBtn, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setButtonColor</span>(<span class="params">self,color = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> color:</span><br><span class="line">            color = <span class="variable language_">self</span>.light.color.get()</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(color) == <span class="number">3</span>, <span class="string">&quot;You must provide a list of 3 Color&quot;</span></span><br><span class="line">        </span><br><span class="line">        r,g,b = [c*<span class="number">255</span> <span class="keyword">for</span> c <span class="keyword">in</span> color]</span><br><span class="line">        <span class="variable language_">self</span>.colorBtn.setStyleSheet(<span class="string">&#x27;background-color: rgba(&#123;&#125;,&#123;&#125;,&#123;&#125;,1.0)&#x27;</span>.<span class="built_in">format</span>(r,g,b))</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setColor</span>(<span class="params">self</span>):</span><br><span class="line">        lightColor = <span class="variable language_">self</span>.light.color.get()</span><br><span class="line">        color = pm.colorEditor(rgbValue = lightColor)</span><br><span class="line">        <span class="comment">#print(color) maya编辑器给返回的是个字符串</span></span><br><span class="line">        r,g,b,a = [<span class="built_in">float</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> color.split()]</span><br><span class="line">        color = (r,g,b)</span><br><span class="line">        <span class="comment"># 改变灯光颜色</span></span><br><span class="line">        <span class="variable language_">self</span>.light.color.<span class="built_in">set</span>(color)</span><br><span class="line">        <span class="comment"># 改变UI上的颜色</span></span><br><span class="line">        <span class="variable language_">self</span>.setButtonColor(color)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disableLight</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name.setChecked(<span class="keyword">not</span> value)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deleteLight</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 删除UI</span></span><br><span class="line">        <span class="variable language_">self</span>.setParent(<span class="literal">None</span>)</span><br><span class="line">        <span class="variable language_">self</span>.setVisible(<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.deleteLater()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 删除灯光</span></span><br><span class="line">        pm.delete(<span class="variable language_">self</span>.light.getTransform())</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showUI</span>():</span><br><span class="line">    ui = LightManager()</span><br><span class="line">    ui.show()</span><br><span class="line">    <span class="keyword">return</span> ui</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lightingManager</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">importlib.reload(lightingManager)</span><br><span class="line"></span><br><span class="line">ui = lightingManager.LightManager().show()</span><br></pre></td></tr></table></figure>

<p><img src="/../../../../../%25E5%25AD%25A6%25E4%25B9%25A0/%25E6%25B5%2599%25E5%25A4%25A7/Python%2520in%2520Maya/note/Class5/image-20220703181152950.png" alt="image-20220703181152950"></p>
<p>将窗口设为maya窗口的子窗口后，窗口和maya工作区成为一个整体，在maya工作区工作不会让组件窗口消失了，在任务栏也不会看到额外的maya窗口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lightingManager</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">importlib.reload(lightingManager)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ui = lightingManager.LightManager().show()</span></span><br><span class="line"><span class="comment">#lightingManager.LightManager().show()</span></span><br><span class="line">lightingManager.getDock()</span><br></pre></td></tr></table></figure>

<p><img src="/../../../../../%25E5%25AD%25A6%25E4%25B9%25A0/%25E6%25B5%2599%25E5%25A4%25A7/Python%2520in%2520Maya/note/Class5/image-20220703181632027.png" alt="image-20220703181632027"></p>
<h3 id="Handle-error"><a href="#Handle-error" class="headerlink" title="Handle error"></a>Handle error</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#raise &quot;message&quot;#raise会停止后面的语句</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>():</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="comment">#用try except来处理，当出现错误又不希望程序停止时</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    do()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;There was an Error&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Goodbye&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Hello</span></span><br><span class="line"><span class="comment">#There was an Error</span></span><br><span class="line"><span class="comment">#Goodbye</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError()<span class="comment">#IOError(),Exception()</span></span><br><span class="line"><span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RuntimeError&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:<span class="comment">#else也可以用</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;other error&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Running&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RuntimeError&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;no error&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;done&quot;</span>)</span><br><span class="line"><span class="comment">#Running</span></span><br><span class="line"><span class="comment">#no error</span></span><br><span class="line"><span class="comment">#done</span></span><br><span class="line"><span class="comment">#执行try后，else一定会被执行(except 可以看作一种if)</span></span><br></pre></td></tr></table></figure>

<h3 id="Exporting-and-Importing-Our-Lights"><a href="#Exporting-and-Importing-Our-Lights" class="headerlink" title="Exporting and Importing Our Lights"></a>Exporting and Importing Our Lights</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">saveBtn = QtWidgets.QPushButton(<span class="string">&#x27;Save&#x27;</span>)</span><br><span class="line">saveBtn.clicked.connect(<span class="variable language_">self</span>.saveLights)</span><br><span class="line">layout.addWidget(saveBtn,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">saveLights</span>(<span class="params">self</span>):</span><br><span class="line">    properties = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> lightWidget <span class="keyword">in</span> <span class="variable language_">self</span>.findChildren(LightWidget):</span><br><span class="line">        light = lightWidget.light</span><br><span class="line">        transform = light.getTransform()</span><br><span class="line"></span><br><span class="line">        properties[<span class="built_in">str</span>(transform)] = &#123;</span><br><span class="line">            <span class="string">&quot;translate&quot;</span>: <span class="built_in">list</span>(transform.translate.get()),</span><br><span class="line">            <span class="string">&quot;rotation&quot;</span>: <span class="built_in">list</span>(transform.rotate.get()),</span><br><span class="line">            <span class="string">&quot;lightType&quot;</span>: pm.objectType(light),</span><br><span class="line">            <span class="string">&quot;intensity&quot;</span>: light.intensity.get(),</span><br><span class="line">            <span class="string">&quot;color&quot;</span>: light.color.get()</span><br><span class="line">        &#125;</span><br><span class="line">    directory = os.path.join(pm.internalVar(userAppDir = <span class="literal">True</span>),<span class="string">&#x27;lightManager&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        os.mkdir(directory)</span><br><span class="line">    lightFile = os.path.join(directory,<span class="string">&#x27;lightFile_&#123;&#125;.json&#x27;</span>.<span class="built_in">format</span>(time.strftime(<span class="string">&#x27;%m%d&#x27;</span>)))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(lightFile, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(properties, f, indent = <span class="number">4</span>)</span><br><span class="line">    logger.info(<span class="string">&quot;Saving file to &#123;&#125;&quot;</span>.<span class="built_in">format</span>(lightFile))</span><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">importBtn = QtWidgets.QPushButton(<span class="string">&#x27;Import&#x27;</span>)</span><br><span class="line">importBtn.clicked.connect(<span class="variable language_">self</span>.importLights)</span><br><span class="line">layout.addWidget(importBtn,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">importLights</span>(<span class="params">self</span>):</span><br><span class="line">    directory = <span class="variable language_">self</span>.getDirectory()</span><br><span class="line">    fileName = QtWidgets.QFileDialog.getOpenFileName(<span class="variable language_">self</span>, <span class="string">&quot;Light Browser&quot;</span>, directory)</span><br><span class="line">    <span class="comment">#print(fileName)#(&#x27;C:/Users/XZYW/文档/maya/lightManager/lightFile_0703.json&#x27;, &#x27;所有文件 (*)&#x27;)</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName[<span class="number">0</span>], <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        properties = json.load(f)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> light, info <span class="keyword">in</span> properties.items():</span><br><span class="line">        lightType = info.get(<span class="string">&#x27;lightType&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> lt <span class="keyword">in</span> <span class="variable language_">self</span>.lightTypes:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;&#123;&#125;Light&quot;</span>.<span class="built_in">format</span>(lt.split()[<span class="number">0</span>].lower()) == lightType:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logger.info(<span class="string">&quot;Cannot find a corresponding lightType for &#123;&#125; (&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(light, lightType))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        light = <span class="variable language_">self</span>.createLight(lightType = lt)</span><br><span class="line">        light.intensity.<span class="built_in">set</span>(info.get(<span class="string">&#x27;intensity&#x27;</span>))</span><br><span class="line">        light.color.<span class="built_in">set</span>(info.get(<span class="string">&#x27;color&#x27;</span>))</span><br><span class="line">        transform = light.getTransform()</span><br><span class="line">        transform.translate.<span class="built_in">set</span>(info.get(<span class="string">&#x27;translate&#x27;</span>))</span><br><span class="line">        transform.rotate.<span class="built_in">set</span>(info.get(<span class="string">&#x27;rotation&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="variable language_">self</span>.populate()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createLight</span>(<span class="params">self, lightType = <span class="literal">None</span>, add = <span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> lightType:</span><br><span class="line">        lightType = <span class="variable language_">self</span>.lightTypeCB.currentText()</span><br><span class="line">    func = <span class="variable language_">self</span>.lightTypes[lightType]</span><br><span class="line">    </span><br><span class="line">    light = func()</span><br><span class="line">    <span class="keyword">if</span> add:</span><br><span class="line">        <span class="variable language_">self</span>.addLight(light)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> light</span><br></pre></td></tr></table></figure>

<h3 id="命令行-文件重命名"><a href="#命令行-文件重命名" class="headerlink" title="命令行 文件重命名"></a>命令行 文件重命名</h3><p>cliRenamer.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description = <span class="string">&quot;This is a batch renamer&quot;</span>, usage = <span class="string">&quot;To replace all files with hello with goodbye instead: python clirenamer.py hello goodbye&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;inString&#x27;</span>, <span class="built_in">help</span> = <span class="string">&quot;The world to replace&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;outString&#x27;</span>, <span class="built_in">help</span> = <span class="string">&quot;The world to replace it with&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--duplicate&#x27;</span>, <span class="built_in">help</span> = <span class="string">&quot;Whether to duplicate or replace in spot&quot;</span>, action = <span class="string">&#x27;store_true&#x27;</span>)<span class="comment">#默认为False</span></span><br><span class="line">    parser.add_argument(<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;--regex&#x27;</span>,</span><br><span class="line">                       <span class="built_in">help</span> = <span class="string">&quot;Whether the patterns are regex or not&quot;</span>,</span><br><span class="line">                       action = <span class="string">&quot;store_true&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;--out&#x27;</span>,</span><br><span class="line">                       <span class="built_in">help</span> = <span class="string">&quot;The output location. Defaults to here&quot;</span>)</span><br><span class="line">    args = parser.parser_args()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(args)</span><br><span class="line">	rename(args.inString,args.outString, duplicate = args.duplicate,</span><br><span class="line">          outDirectory = args.out, regex = args.regex)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rename</span>(<span class="params">inString, outString, duplicate = <span class="literal">True</span>, inDirectory = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">           outDirectory = <span class="literal">None</span>, regex = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> inDirectory:</span><br><span class="line">        inDirectory = os.getcwd()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> outDirectory:</span><br><span class="line">        outDIrectory = inDirectory</span><br><span class="line">    outDirectory = os.path.abspath(outDirectory)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(outDirectory):</span><br><span class="line">        <span class="keyword">raise</span> IOError(<span class="string">&#x27;&#123;&#125; does not exist&#x27;</span>.<span class="built_in">format</span>(outDirectory))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(inDirectory):</span><br><span class="line">        <span class="keyword">raise</span> IOError(<span class="string">&#x27;&#123;&#125; does not exist&#x27;</span>.<span class="built_in">format</span>(inDirectory))</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(inDirectory):</span><br><span class="line">        <span class="keyword">if</span> .startwith(<span class="string">&#x27;.&#x27;</span>):<span class="comment">#linux,mac中.开头表示隐藏文件</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span> regex:</span><br><span class="line">            name = re.sub(inString, outString, f)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        	name = f.replace(inString, outString)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(name)</span><br><span class="line">        <span class="keyword">if</span> name == f:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        src = os.path.join(inDirectory, f)</span><br><span class="line">        dest = os.path.join(outDirectory, name)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> duplicate:</span><br><span class="line">            shutil.copy2(src, dest)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            os.rename(src, dest)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:z</span><br><span class="line">    main()<span class="comment">#分离命名空间，只有当这个文件命名空间是main的时候才运行</span></span><br></pre></td></tr></table></figure>



<h3 id="sys模块"><a href="#sys模块" class="headerlink" title="sys模块"></a>sys模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess<span class="comment">#子进程</span></span><br><span class="line">subprocess.call([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;../cliRenamer.py&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/09/10/TA/Maya/cmds%EF%BC%88%E5%9B%9B%EF%BC%89/" data-id="cmfe1kyaq0011ykuhb9vhdg26" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  
  
<nav class="article-nav">
  
  <a href="/2025/09/10/TA/Maya/cmds%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-nav-link">
    <strong class="article-nav-caption">Newer</strong>
    <div class="article-nav-title">
      
      (no title)
      
    </div>
  </a>
  
  
  <a href="/2025/09/10/TA/Graphics/Sampling/" class="article-nav-link">
    <strong class="article-nav-caption">Older</strong>
    <div class="article-nav-title"></div>
  </a>
  
</nav>

  

  
  
  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>XZYW7&#39;s Blog &copy; 2025</li>
      
        <li>
          
            <a href="https://beian.miit.gov.cn/" target="_blank"></a>
            
        </li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
    <p><ul class="list-inline">
  
  <li><i class="fe fe-smile-alt tooltip" data-tooltip="UV"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark tooltip" data-tooltip="PV"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul></p>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="XZYW7&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>





<script src="/js/tocbot.min.js"></script>


<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>