<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <title>
    
    XZYW7&#39;s Blog
  </title>
  <!-- Icon -->
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-TA/百人计划/图形2.3常用函数介绍" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    

    
    <div class="article-meta">
      <a href="/2025/09/10/TA/%E7%99%BE%E4%BA%BA%E8%AE%A1%E5%88%92/%E5%9B%BE%E5%BD%A22.3%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/" class="article-date">
  <time datetime="2025-09-10T13:18:14.022Z" itemprop="datePublished">2025-09-10</time>
</a>
      
    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
        <h1 id="图形2-3-常用函数介绍（HLSL）"><a href="#图形2-3-常用函数介绍（HLSL）" class="headerlink" title="图形2.3 常用函数介绍（HLSL）"></a>图形2.3 常用函数介绍（HLSL）</h1><p>微软文档HLSL内部函数：</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/direct3dhlsl/dx-graphics-hlsl-intrinsic-functions">https://docs.microsoft.com/zh-cn/windows/win32/direct3dhlsl/dx-graphics-hlsl-intrinsic-functions</a></p>
<h3 id="一、基本数学运算"><a href="#一、基本数学运算" class="headerlink" title="一、基本数学运算"></a>一、基本数学运算</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">max</span>(a,b)<span class="comment">//最大值</span></span><br><span class="line"><span class="built_in">min</span>(a,b)<span class="comment">//最小值</span></span><br><span class="line">mul(a,b)<span class="comment">//变量相乘，矩阵、向量运算（a是向量则看作行向量，b是向量则看作列向量）</span></span><br><span class="line"><span class="built_in">abs</span>(a)<span class="comment">//绝对值</span></span><br><span class="line"><span class="built_in">round</span>(x)<span class="comment">//最接近的整数</span></span><br><span class="line"><span class="built_in">sqrt</span>(x)<span class="comment">//平方根</span></span><br><span class="line">rsqrt(x)<span class="comment">//平方根倒数</span></span><br><span class="line"><span class="built_in">degrees</span>(x)<span class="comment">//弧度转角度</span></span><br><span class="line">redians(x)<span class="comment">//角度转弧度</span></span><br><span class="line">noise(x)<span class="comment">//噪声函数</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/XirtyqUXBhtPF1TVBTHfSA" alt="img" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/PoFwPqTWyla31R3yk3012w" alt="img" style="zoom:50%;" />

<h3 id="二、幂指对函数"><a href="#二、幂指对函数" class="headerlink" title="二、幂指对函数"></a>二、幂指对函数</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pow</span>(x,y);<span class="comment">//x^y</span></span><br><span class="line"><span class="built_in">exp</span>(x);<span class="comment">//e^x</span></span><br><span class="line"><span class="built_in">exp2</span>(x);<span class="comment">//2^x</span></span><br><span class="line"><span class="built_in">ldexp</span>(x, <span class="built_in">exp</span>);<span class="comment">//x*2^exp</span></span><br><span class="line"><span class="built_in">log</span>(x);<span class="comment">//lnx</span></span><br><span class="line">log10(x);<span class="comment">//log_10 x</span></span><br><span class="line"><span class="built_in">log2</span>(x);<span class="comment">//log_2 x</span></span><br><span class="line"><span class="built_in">frexp</span>(x, <span class="keyword">out</span> <span class="built_in">exp</span>);<span class="comment">//把浮点数x分解为尾数mantissa和指数 x = ret * 2^exp，返回值是位数，exp参数返回的值是指数（如果x参数为0，则尾数和指数均返回0）</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/_yUmM743gYLSz4W_MD43_A" alt="img" style="zoom:50%;" />

<h3 id="三、三角函数与双曲函数"><a href="#三、三角函数与双曲函数" class="headerlink" title="三、三角函数与双曲函数"></a>三、三角函数与双曲函数</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sin</span>(x);<span class="built_in">cos</span>(x);<span class="built_in">tan</span>(x);<span class="comment">//x均为弧度</span></span><br><span class="line">sincos(x, <span class="keyword">out</span> s, <span class="keyword">out</span> c);<span class="comment">//返回x的正弦值和余弦值</span></span><br><span class="line"><span class="built_in">tan</span>(y,x);<span class="comment">//返回y/x的正切值</span></span><br><span class="line"><span class="built_in">asin</span>(x);<span class="comment">//反正弦</span></span><br><span class="line"><span class="built_in">acos</span>(x);<span class="comment">//反余弦</span></span><br><span class="line"><span class="built_in">atan</span>(x);<span class="comment">//反正切</span></span><br><span class="line">atan2(y,x);<span class="comment">//输出y/x的反正切</span></span><br><span class="line"><span class="built_in">sinh</span>(x);<span class="comment">//双曲正弦,(e^x-e^(-x))/2</span></span><br><span class="line"><span class="built_in">cosh</span>(x);<span class="comment">//双曲余弦,(e^x+e^(-x))/2</span></span><br><span class="line"><span class="built_in">tanh</span>(x);<span class="comment">//双曲正切,(e^x-e^(-x))/(e^x+e^(-x))</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/-LFsB20otdFaLNoYINhjAw" alt="img" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/Vg17wEEh7tRZ3NIyopuNxA" alt="img" style="zoom:50%;" />

<h3 id="四、数据范围类"><a href="#四、数据范围类" class="headerlink" title="四、数据范围类"></a>四、数据范围类</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ceil</span>(x);<span class="comment">//向上取整</span></span><br><span class="line"><span class="built_in">floor</span>(x);<span class="comment">//向下取整</span></span><br><span class="line"><span class="built_in">step</span>(x,y);<span class="comment">//x&lt;=y为1，否则为0</span></span><br><span class="line">saturate(x);<span class="comment">//返回将x钳制到0和1之间的值</span></span><br><span class="line"><span class="built_in">clamp</span>(x,<span class="built_in">min</span>,<span class="built_in">max</span>);<span class="comment">//把x限制在[min,max]范围内，</span></span><br><span class="line">fmord(x,y);<span class="comment">//返回x对y取余的余数</span></span><br><span class="line">frac(x);<span class="comment">//返回x的小数部分</span></span><br><span class="line"><span class="built_in">modf</span>(x, <span class="keyword">out</span> ip);<span class="comment">//将x分为小数和整数部分（符号与x相同），ip返回整数部分，整体返回小数部分</span></span><br><span class="line">lerp(x,y,s);<span class="comment">//按照s在x到y之间插值（x*(1-s)+y*s）</span></span><br><span class="line"><span class="built_in">smoothstep</span>(<span class="built_in">min</span>,<span class="built_in">max</span>,x);<span class="comment">//如果x在min和max范围内，则返回01之间的平滑Hermite插值，使用smoothstep在两个值之间创建平滑过渡。例如平滑混合两种颜色</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/cSnp8bVk3apu9oljyC2FfA" alt="img" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/SYF5uMwuuk_PaEZ6aR3G_Q" alt="img" style="zoom:50%;" />

<h3 id="五、类型判断类"><a href="#五、类型判断类" class="headerlink" title="五、类型判断类"></a>五、类型判断类</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">all</span>(x);<span class="comment">//确定x所有分量是否均为非零，均非零则返回true，否则false（处理浮点型、整形、布尔型数据定义的标量、向量或矩阵）</span></span><br><span class="line">clip(x);<span class="comment">//如果x小于零，则丢弃当前像素，常用于判定范围（不仅针对0，返回值为void）。常用于测试alpha，如果每个分量代表到平面距离，还可用来模拟剪切平面</span></span><br><span class="line"><span class="built_in">sign</span>(x);<span class="comment">//返回x正负性，小于0为-1，大于0为1，0则返回0</span></span><br><span class="line"><span class="built_in">isinf</span>(x);<span class="comment">//x为+INF或-INF则为true，否则false</span></span><br><span class="line">isfinite(x);<span class="comment">//判断x是有限的，与isinf相反</span></span><br><span class="line"><span class="built_in">isnan</span>(x);<span class="comment">//如果x为NAN(非数字),返回true，否则false</span></span><br></pre></td></tr></table></figure>

<h3 id="六、向量与矩阵类"><a href="#六、向量与矩阵类" class="headerlink" title="六、向量与矩阵类"></a>六、向量与矩阵类</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">length</span>(v);<span class="comment">//向量模长</span></span><br><span class="line"><span class="built_in">normalize</span>(v);<span class="comment">//x/length(x)归一化</span></span><br><span class="line"><span class="built_in">distance</span>(a,b);<span class="comment">//向量之间的距离（表示的点的距离）</span></span><br><span class="line"><span class="built_in">dot</span>(a,b);<span class="comment">//点乘</span></span><br><span class="line"><span class="built_in">cross</span>(a,b);<span class="comment">//叉乘</span></span><br><span class="line"><span class="built_in">determinant</span>(m);<span class="comment">//矩阵m的行列式</span></span><br><span class="line"><span class="built_in">transpose</span>(m);<span class="comment">//m的转置矩阵</span></span><br></pre></td></tr></table></figure>

<h3 id="七、光线运算"><a href="#七、光线运算" class="headerlink" title="七、光线运算"></a>七、光线运算</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意所有的入射方向都表示入射方向的相反方向</span></span><br><span class="line"><span class="built_in">reflect</span>(i,n);<span class="comment">//计算入射方向i对于法线n的反射方向</span></span><br><span class="line">fefract(i,n,ri);<span class="comment">//入射方向i，法线n，ri折射率，计算折射方向</span></span><br><span class="line">lit(n_dot_l,n_dot_h,m);<span class="comment">//返回照明系数向量(ambient,diffuse,specular,1)</span></span><br><span class="line"><span class="comment">//ambient=1</span></span><br><span class="line"><span class="comment">//diffuse = ndotl&lt;0 ? 0 : ndotl</span></span><br><span class="line"><span class="comment">//specular = ndotl&lt;0 || ndoth &lt; 0 ? 0: ndoth^m</span></span><br><span class="line"><span class="built_in">faceforward</span>(n,i,ng);<span class="comment">//输出法线n，输入视线方向i，表面法线方向ng，反转表面法线（如有必要）以面向和i相反的方向，在n中返回结果</span></span><br><span class="line"><span class="comment">//返回-n*sign(dot(i,ng))</span></span><br></pre></td></tr></table></figure>

<h3 id="八、1D纹理查找（几乎不用）"><a href="#八、1D纹理查找（几乎不用）" class="headerlink" title="八、1D纹理查找（几乎不用）"></a>八、1D纹理查找（几乎不用）</h3><p>函数ddx，ddy用于求取相邻像素间某属性的差值；输入参数通常是纹理坐标，返回相邻像素间的属性差值；</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tex1D(s,t);<span class="comment">//一维纹理查找，返回纹理采样器s在标量t位置的color4</span></span><br><span class="line">tex1D(s,t,ddx,ddy);<span class="comment">//微分查询一维纹理ddx,ddy均为向量</span></span><br><span class="line">tex1Dlod(s,t);<span class="comment">//使用LOD查找纹理s在t.w位置的color4</span></span><br><span class="line">tex1Dbias(s,t);<span class="comment">//t.w决定的某个mip层偏置后的一维纹理查找</span></span><br><span class="line">tex1Dgrad(s,t,ddx,ddy);<span class="comment">//使用微分并指定mip层的一维纹理查找</span></span><br><span class="line">tex1Dproj(s,t);<span class="comment">//把纹理当作一张幻灯片投影到场景中，计算出投影纹理坐标t(t.w除以透视值),然后使用投影纹理坐标查询</span></span><br></pre></td></tr></table></figure>

<h3 id="九、2D纹理查找"><a href="#九、2D纹理查找" class="headerlink" title="九、2D纹理查找"></a>九、2D纹理查找</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tex2D(s,t);<span class="comment">//二维纹理查找，返回纹理采样器s在t(x,y)位置的color4</span></span><br><span class="line">tex2D(s,t,ddx,ddy);<span class="comment">//微分查询二维纹理t,ddx,ddy均为向量</span></span><br><span class="line">tex2Dlod(s,t);<span class="comment">//使用LOD查找纹理s在t.w位置的color4</span></span><br><span class="line">tex2Dbias(s,t);<span class="comment">//t.w决定的某个mip层偏置后的二维纹理查找</span></span><br><span class="line">tex2Dgrad(s,t,ddx,ddy);<span class="comment">//使用微分并指定mip层的二维纹理查找</span></span><br><span class="line">tex2Dproj(s,t);<span class="comment">//把纹理当作一张幻灯片投影到场景中，计算出投影纹理坐标t(t.w除以透视值),然后使用投影纹理坐标查询</span></span><br></pre></td></tr></table></figure>

<h3 id="十、3D纹理查找"><a href="#十、3D纹理查找" class="headerlink" title="十、3D纹理查找"></a>十、3D纹理查找</h3><p>3D纹理资源（体积纹理），包含3D体积的纹理像素</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tex3D(s,t);<span class="comment">//三维纹理查找，返回纹理采样器s在vec t位置的color4</span></span><br><span class="line">tex3D(s,t,ddx,ddy);<span class="comment">//微分查询三维纹理t,ddx,ddy均为向量</span></span><br><span class="line">tex3Dlod(s,t);<span class="comment">//使用LOD查找纹理s在t.w位置的color4</span></span><br><span class="line">tex3Dbias(s,t);<span class="comment">//t.w决定的某个mip层偏置后的立方体纹理查找</span></span><br><span class="line">tex3Dgrad(s,t,ddx,ddy);<span class="comment">//使用微分并指定mip层的立方体纹理查找</span></span><br><span class="line">tex3Dproj(s,t);<span class="comment">//使用投影方式的立方体文里查找</span></span><br></pre></td></tr></table></figure>

<h3 id="十一、立体纹理查找"><a href="#十一、立体纹理查找" class="headerlink" title="十一、立体纹理查找"></a>十一、立体纹理查找</h3><p>指CubeMap</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">texCUBE(s,t);<span class="comment">//返回纹理采样器s在vec t位置的color4</span></span><br><span class="line">texCUBE(s,t,ddx,ddy);<span class="comment">//微分查询立方体纹理t,ddx,ddy均为向量</span></span><br><span class="line">texCUBElod(s,t);<span class="comment">//使用LOD查找纹理s在t.w位置的color4</span></span><br><span class="line">texCUBEbias(s,t);<span class="comment">//t.w决定的某个mip层偏置后的三维纹理查找</span></span><br><span class="line">texCUBEgrad(s,t,ddx,ddy);<span class="comment">//使用微分并指定mip层的三维纹理查找</span></span><br><span class="line">texCUBEproj(s,t);<span class="comment">//把纹理当作一张幻灯片投影到场景中，计算出投影纹理坐标t(t.w除以透视值),然后使用投影纹理坐标查询</span></span><br></pre></td></tr></table></figure>

<h3 id="作业"><a href="#作业" class="headerlink" title="作业"></a><strong>作业</strong></h3><ul>
<li>写出最常用的5个函数<ul>
<li>dot，mul，normalize，tex2d，pow</li>
</ul>
</li>
<li>这是我当前感觉最常用的，dot和mul不必说，向量矩阵运算必备；而由于光照计算中使用方向，常常需要对向量归一化；有贴图就有纹理采样；最后这个pow方法，看看各种光照模型的公式里，就有很多地方出现幂运算了。</li>
<li>ddx ddy的实际使用测试</li>
</ul>
<h4 id="ddx-ddy与法线贴图"><a href="#ddx-ddy与法线贴图" class="headerlink" title="ddx&#x2F;ddy与法线贴图"></a><strong>ddx&#x2F;ddy与法线贴图</strong></h4><h5 id="ddx-ddy计算法线"><a href="#ddx-ddy计算法线" class="headerlink" title="ddx&#x2F;ddy计算法线"></a><strong>ddx&#x2F;ddy计算法线</strong></h5><p>首先ddx与ddy是两个函数，完整的表达是ddx(m),ddy(m)。</p>
<p>在glsl中，它相当于dFdx(m),dFdy(m)。</p>
<p>这两个函数只能作用于片元着色器中，根据他们的作用也很好理解这一点。</p>
<p>我们需要提供一个属性，然后这个函数会计算当前片元在屏幕空间中，沿x或y方向关于这个属性的偏导，因为片元是离散的，当然是以差分形式。</p>
<img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/6271001-7e5f13306d7c9131.png" alt="img" style="zoom: 33%;" />

<p>如果是考虑<strong>世界空间位置</strong>这一属性，我的理解是，对于当前着色点，计算的是这两个方向的切线方向。</p>
<p>于是有一个通常的法线计算方法</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">normal = <span class="built_in">normalize</span>(<span class="built_in">cross</span>(ddx(pos),ddy(pos)));</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/image-20220728230748527.png" alt="image-20220728230748527"></p>
<p>左边是ddx，ddy计算出的法线，右边是顶点法线在fs中插值的法线。</p>
<p>很明显，这两者就好像flat shading和phong shading的关系。仔细想想确实如此。不考虑着色，只考虑几何信息，这个球体本来就是三角网格</p>
<p><img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/image-20220728230953252.png" alt="image-20220728230953252"></p>
<p>对于三角形上的一个点的法线，使用切线叉乘计算的法线当然是原原本本的网格法线。而右边的法线是顶点法线插值。</p>
<p>在unity中还原flat shading或是low poly风格的渲染，确实会采用ddx和ddy的方法。</p>
<h5 id="ddx-ddy与法线贴图-1"><a href="#ddx-ddy与法线贴图-1" class="headerlink" title="ddx&#x2F;ddy与法线贴图"></a><strong>ddx&#x2F;ddy与法线贴图</strong></h5><p>learnopengl中这一段代码给我留下了深刻印象。当时用的时候完全不知道dFdx是做什么的，只能硬着头皮用了。现在我们已经了解了ddx函数，再回过头来看一下它对发现贴图的处理。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Easy trick to get tangent-normals to world-space to keep PBR code simplified.</span></span><br><span class="line"><span class="comment">// Don&#x27;t worry if you don&#x27;t get what&#x27;s going on; you generally want to do normal </span></span><br><span class="line"><span class="comment">// mapping the usual way for performance anways; I do plan make a note of this </span></span><br><span class="line"><span class="comment">// technique somewhere later in the normal mapping tutorial.</span></span><br><span class="line"><span class="type">vec3</span> getNormalFromMap()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">vec3</span> tangentNormal = <span class="built_in">texture</span>(normalMap, TexCoords).xyz * <span class="number">2.0</span> - <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">vec3</span> Q1  = <span class="built_in">dFdx</span>(WorldPos);</span><br><span class="line">    <span class="type">vec3</span> Q2  = <span class="built_in">dFdy</span>(WorldPos);</span><br><span class="line">    <span class="type">vec2</span> st1 = <span class="built_in">dFdx</span>(TexCoords);</span><br><span class="line">    <span class="type">vec2</span> st2 = <span class="built_in">dFdy</span>(TexCoords);</span><br><span class="line"></span><br><span class="line">    <span class="type">vec3</span> N   = <span class="built_in">normalize</span>(Normal);</span><br><span class="line">    <span class="type">vec3</span> T  = <span class="built_in">normalize</span>(Q1*st2.t - Q2*st1.t);</span><br><span class="line">    <span class="type">vec3</span> B  = -<span class="built_in">normalize</span>(<span class="built_in">cross</span>(N, T));</span><br><span class="line">    <span class="type">mat3</span> TBN = <span class="type">mat3</span>(T, B, N);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">normalize</span>(TBN * tangentNormal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心就是求TBN矩阵嘛。N向量和B向量都很好理解，一个直接就是模型法线，一个就是由叉乘计算的副切线。</p>
<p>问题就在于切线的计算。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">vec3</span> T  = <span class="built_in">normalize</span>(Q1*st2.t - Q2*st1.t);</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/XZYW7/PicGo/main/img/normal_mapping_surface_edges.png" alt="img"></p>
<p>（这里把E1看作Q1，E2看作Q2）</p>
<p>$E_1&#x3D;ΔU_1T+ΔV_1B$</p>
<p>$E_2&#x3D;ΔU_2T+ΔV_2B$</p>
<p>这样再结合cpu计算TBN的方法，就很好理解了。</p>
<p>似乎后面的课程马上就会到法线贴图的部分，到时候再详述好了。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><strong>参考资料</strong></h3><p>[1] <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1q64y1m7Ev">https://www.bilibili.com/video/BV1q64y1m7Ev</a> 【技术美术百人计划】图形 2.3 常用函数介绍</p>
<p>[2] <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7fc6a2fef29d">https://www.jianshu.com/p/7fc6a2fef29d</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://learnopengl.com/code_viewer_gh.php?code=src/6.pbr/1.2.lighting_textured/1.2.pbr.fs">https://learnopengl.com/code_viewer_gh.php?code=src/6.pbr/1.2.lighting_textured/1.2.pbr.fs</a></p>
<p>[4] <a target="_blank" rel="noopener" href="https://learnopengl-cn.github.io/05%20Advanced%20Lighting/04%20Normal%20Mapping/">https://learnopengl-cn.github.io/05%20Advanced%20Lighting/04%20Normal%20Mapping/</a></p>
<p>[5] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/484182779">https://zhuanlan.zhihu.com/p/484182779</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/09/10/TA/%E7%99%BE%E4%BA%BA%E8%AE%A1%E5%88%92/%E5%9B%BE%E5%BD%A22.3%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/" data-id="cmfe1u6pe001vscuh7mao9yie" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  
  
<nav class="article-nav">
  
  <a href="/2025/09/10/TA/%E7%99%BE%E4%BA%BA%E8%AE%A1%E5%88%92/%E5%9B%BE%E5%BD%A22.2%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%9D%90%E8%B4%A8%E5%9F%BA%E7%A1%80/" class="article-nav-link">
    <strong class="article-nav-caption">Newer</strong>
    <div class="article-nav-title">
      
      (no title)
      
    </div>
  </a>
  
  
  <a href="/2025/09/10/TA/%E7%99%BE%E4%BA%BA%E8%AE%A1%E5%88%92/%E5%9B%BE%E5%BD%A22.4%20%E4%BC%A0%E7%BB%9F%E7%BB%8F%E9%AA%8C%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/" class="article-nav-link">
    <strong class="article-nav-caption">Older</strong>
    <div class="article-nav-title"></div>
  </a>
  
</nav>

  

  
  
  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>XZYW7&#39;s Blog &copy; 2025</li>
      
        <li>
          
            <a href="https://beian.miit.gov.cn/" target="_blank"></a>
            
        </li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
    <p><ul class="list-inline">
  
  <li><i class="fe fe-smile-alt tooltip" data-tooltip="UV"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark tooltip" data-tooltip="PV"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul></p>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="XZYW7&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>





<script src="/js/tocbot.min.js"></script>


<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>